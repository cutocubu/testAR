<script src="https://aframe.io/releases/0.9.1/aframe.min.js"></script>
<script src="https://rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>
<script src="https://rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>

<!-- import events.js script -->
<script src="https://rawgit.com/nicolocarpignoli/nicolocarpignoli.github.io/master/ar-click-events/events.js"></script>
<body style='margin : 0px; overflow: hidden;'>

    <a-scene vr-mode-ui="enabled: false" embedded arjs='sourceType: webcam;' camera touch-controls>
        <a-entity sound="src: url(test.mp3); autoplay: true" id="animated-marker" position='0 0.5 0' gltf-model="Bee.glb" scale="0.05 0.05 0.05" animation-mixer fix-scale></a-entity>

        <a-marker-camera id="audio-marker" type="pattern" preset="custom" url="pattern-marvy.patt"></a-marker-camera>
    </a-scene>
</body>
<script>
    //To avoid playing from start if the marker flickers, not sure if needed, but it might be a failsafe when you have mutiple markers and want to make sure the first finishes before launching the second
var playing = false;

//HTML5 audio, will need user touch input to start on mobile
var intro = new Audio("test.mp3");

//Detect end of audio
intro.addEventListener("ended", function() {
	intro.currentTime = 0;
	playing = false;
});

AFRAME.registerComponent('teo', {
	init: function() {
		// Set up the tick throttling. Will check if marker is active every 500ms
		this.tick = AFRAME.utils.throttleTick(this.tick, 500, this);
	},
	tick: function(t, dt) {
		
		if (document.querySelector("#audio-marker").object3D.visible == true && playing == false) {
			// MARKER IS PRESENT
			intro.play();
            playing = true;
            console.log(123);
		} else {
			// MARKER IS HIDDEN, do nothing (up to you)
		}

	}
});
</script>
<!--<script src="https://aframe.io/releases/0.7.1/aframe.min.js"></script>
<script src="https://google-ar.github.io/three.ar.js/dist/three.ar.js"></script>
<script src="https://rawgit.com/chenzlabs/aframe-ar/827e9db/dist/aframe-ar.min.js"></script>
<body>
    <a-scene ar>
        <a-camera user-height="0" cursor="fuse:false" ar-raycaster raycaster="objects:none"></a-camera>
        <a-box width="0.25" height="0.25" depth="0.25" position="-0.25 0.125 -0.75" rotation="0 45 0" color="#4CC3D9"></a-box>
        <a-sphere position="0 0.3125 -1.25" radius="0.3125" color="#EF2D5E"></a-sphere>
        <a-cylinder position="0.25 0.1875 -0.75" radius="0.125" height="0.375" color="#FFC65D"></a-cylinder>
        <a-plane position="0 0 -1" rotation="-90 0 0" width="1" height="1" color="#7BC8A4" shadow></a-plane>
    </a-scene>
</body>-->
